<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Nề Nếp - Lớp 12A5</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <!-- AnimeJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Login Overlay -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-card">
            <div class="login-icon">
                <i class="fas fa-user-shield"></i>
            </div>
            <h2>Đăng Nhập</h2>
            <p>Quản Lý Nề Nếp Lớp 12A5</p>
            <form id="loginForm">
                <div class="login-field">
                    <i class="fas fa-user"></i>
                    <input type="text" id="loginUsername" placeholder="Tên đăng nhập" required>
                </div>
                <div class="login-field">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="loginPassword" placeholder="Mật khẩu" required>
                </div>
                <div class="login-error" id="loginError"></div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Đăng nhập
                </button>
            </form>
        </div>
    </div>

    <!-- Background Animation -->
    <div class="bg-animation"></div>
    <div class="particles" id="particles"></div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-icon">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <div class="header-info">
                    <h1>Quản Lý Nề Nếp Lớp 12A5</h1>
                    <div class="header-controls">
                        <div class="year-selector">
                            <i class="fas fa-calendar-alt"></i>
                            <select id="schoolYear">
                                <option value="2023-2024">Năm học 2023-2024</option>
                                <option value="2024-2025">Năm học 2024-2025</option>
                                <option value="2025-2026" selected>Năm học 2025-2026</option>
                                <option value="2026-2027">Năm học 2026-2027</option>
                            </select>
                        </div>
                        <div class="user-info" id="userInfo">
                            <span class="user-name" id="userName"></span>
                            <span class="user-role" id="userRole"></span>
                            <button class="logout-btn" id="logoutBtn" title="Đăng xuất">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Stats Dashboard -->
        <div class="stats-row">
            <div class="stat-item">
                <div class="stat-icon total">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalStudents">0</h3>
                    <p>Học sinh</p>
                </div>
            </div>
            <div class="stat-item warning">
                <div class="stat-icon violations">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="todayViolations">0</h3>
                    <p>Vi phạm hôm nay</p>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon rewards">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-info">
                    <h3 id="todayRewards">0</h3>
                    <p>Khen thưởng hôm nay</p>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon average">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-info">
                    <h3 id="averagePoints">0</h3>
                    <p>Điểm TB lớp</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-wrapper">
            <!-- Tabs Navigation -->
            <div class="tabs-nav">
                <button class="tab-btn active" data-tab="records">
                    <i class="fas fa-clipboard-list"></i> Ghi nhận nề nếp
                </button>
                <button class="tab-btn" data-tab="students">
                    <i class="fas fa-users"></i> Danh sách HS
                </button>
                <button class="tab-btn" data-tab="history">
                    <i class="fas fa-history"></i> Lịch sử
                </button>
                <button class="tab-btn" data-tab="stats">
                    <i class="fas fa-chart-bar"></i> Thống kê
                </button>
                <button class="tab-btn admin-only" data-tab="admin" id="adminTab">
                    <i class="fas fa-cog"></i> Quản lý
                </button>
            </div>

            <!-- Tab: Records (Ghi nhận nề nếp) -->
            <div class="tab-content active" id="tab-records">
                <div class="records-layout">
                    <!-- Quick Record Form -->
                    <div class="record-form-card">
                        <h3><i class="fas fa-plus-circle"></i> Ghi nhận mới</h3>
                        <form id="recordForm">
                            <div class="form-group">
                                <label>Ngày</label>
                                <input type="date" id="recordDate" required>
                            </div>
                            <div class="form-group">
                                <label>Học sinh</label>
                                <select id="recordStudent" required>
                                    <option value="">-- Chọn học sinh --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Loại</label>
                                <div class="type-selector">
                                    <label class="type-option violation">
                                        <input type="radio" name="recordType" value="violation" checked>
                                        <span><i class="fas fa-times-circle"></i> Vi phạm</span>
                                    </label>
                                    <label class="type-option reward">
                                        <input type="radio" name="recordType" value="reward">
                                        <span><i class="fas fa-check-circle"></i> Khen thưởng</span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Nội dung</label>
                                <select id="recordCategory" required>
                                    <option value="">-- Chọn nội dung --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Điểm</label>
                                <input type="number" id="recordPoints" placeholder="VD: -5 hoặc +10" required>
                            </div>
                            <div class="form-group">
                                <label>Ghi chú</label>
                                <textarea id="recordNote" rows="2" placeholder="Ghi chú thêm (tùy chọn)"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Lưu ghi nhận
                            </button>
                        </form>
                    </div>

                    <!-- Today's Records -->
                    <div class="today-records-card">
                        <div class="card-header">
                            <h3><i class="fas fa-calendar-day"></i> Ghi nhận hôm nay</h3>
                            <span class="today-date" id="todayDateDisplay"></span>
                        </div>
                        <div class="records-list" id="todayRecordsList">
                            <div class="empty-records">
                                <i class="fas fa-clipboard"></i>
                                <p>Chưa có ghi nhận nào hôm nay</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Students (Quản lý học sinh) -->
            <div class="tab-content" id="tab-students">
                <div class="students-layout">
                    <!-- Add Student Form -->
                    <div class="student-form-card">
                        <h3><i class="fas fa-user-plus"></i> Thêm học sinh</h3>
                        <form id="studentForm">
                            <div class="form-group">
                                <label>Họ và tên</label>
                                <input type="text" id="studentName" placeholder="Nguyễn Văn A" required>
                            </div>
                            <div class="form-group">
                                <label>Giới tính</label>
                                <select id="studentGender" required>
                                    <option value="Nam">Nam</option>
                                    <option value="Nữ">Nữ</option>
                                </select>
                            </div>
                            <div class="form-group admin-only-field" id="studentGroupField">
                                <label>Tổ</label>
                                <select id="studentGroup">
                                    <option value="">-- Không gán tổ --</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary" id="studentSubmitBtn">
                                    <i class="fas fa-plus"></i> Thêm
                                </button>
                                <button type="button" class="btn btn-secondary" id="studentResetBtn">
                                    <i class="fas fa-redo"></i> Làm mới
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Students List -->
                    <div class="students-list-card">
                        <div class="card-header">
                            <h3><i class="fas fa-list"></i> Danh sách lớp 12A5</h3>
                            <div class="card-actions">
                                <button class="btn-icon" id="importStudentsBtn" title="Import từ Excel">
                                    <i class="fas fa-file-import"></i>
                                </button>
                                <button class="btn-icon" id="exportStudentsBtn" title="Xuất Excel">
                                    <i class="fas fa-file-export"></i>
                                </button>
                            </div>
                        </div>
                        <div class="table-wrapper">
                            <table id="studentsTable">
                                <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>Họ và tên</th>
                                        <th>Giới tính</th>
                                        <th>Điểm hiện tại</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody id="studentsTableBody">
                                </tbody>
                            </table>
                        </div>
                        <div class="empty-state" id="emptyStudents">
                            <i class="fas fa-user-graduate"></i>
                            <h3>Chưa có học sinh</h3>
                            <p>Thêm học sinh mới hoặc import từ Excel</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: History (Lịch sử) -->
            <div class="tab-content" id="tab-history">
                <div class="history-controls">
                    <div class="filter-group">
                        <label>Từ ngày:</label>
                        <input type="date" id="historyFromDate">
                    </div>
                    <div class="filter-group">
                        <label>Đến ngày:</label>
                        <input type="date" id="historyToDate">
                    </div>
                    <div class="filter-group">
                        <label>Học sinh:</label>
                        <select id="historyStudent">
                            <option value="">Tất cả</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Loại:</label>
                        <select id="historyType">
                            <option value="">Tất cả</option>
                            <option value="violation">Vi phạm</option>
                            <option value="reward">Khen thưởng</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="applyHistoryFilter">
                        <i class="fas fa-filter"></i> Lọc
                    </button>
                    <button class="btn btn-secondary" id="exportHistoryBtn">
                        <i class="fas fa-file-excel"></i> Xuất Excel
                    </button>
                </div>
                <div class="history-table-wrapper">
                    <table id="historyTable">
                        <thead>
                            <tr>
                                <th>Ngày</th>
                                <th>Học sinh</th>
                                <th>Loại</th>
                                <th>Nội dung</th>
                                <th>Điểm</th>
                                <th>Ghi chú</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                        </tbody>
                    </table>
                </div>
                <div class="empty-state" id="emptyHistory">
                    <i class="fas fa-history"></i>
                    <h3>Chưa có lịch sử</h3>
                    <p>Các ghi nhận sẽ hiển thị ở đây</p>
                </div>
            </div>

            <div class="tab-content" id="tab-stats">
                <div class="stats-grid">
                    <!-- Weekly Summary -->
                    <div class="stats-card full-width">
                        <h3><i class="fas fa-calendar-week"></i> Kết điểm theo tuần</h3>
                        <div id="weeklySummary">
                            <p class="empty-text">Chưa có dữ liệu</p>
                        </div>
                    </div>
                    <!-- Top Violators -->
                    <div class="stats-card">
                        <h3><i class="fas fa-exclamation-circle"></i> Vi phạm nhiều nhất</h3>
                        <div class="stats-list" id="topViolators">
                            <p class="empty-text">Chưa có dữ liệu</p>
                        </div>
                    </div>
                    <!-- Top Performers -->
                    <div class="stats-card">
                        <h3><i class="fas fa-trophy"></i> Học sinh xuất sắc</h3>
                        <div class="stats-list" id="topPerformers">
                            <p class="empty-text">Chưa có dữ liệu</p>
                        </div>
                    </div>
                    <!-- Violation Categories -->
                    <div class="stats-card full-width">
                        <h3><i class="fas fa-chart-pie"></i> Phân loại vi phạm</h3>
                        <div class="category-stats" id="violationCategories">
                            <p class="empty-text">Chưa có dữ liệu</p>
                        </div>
                    </div>
                    <!-- Monthly Summary -->
                    <div class="stats-card full-width">
                        <h3><i class="fas fa-calendar-alt"></i> Tổng kết theo tháng</h3>
                        <div class="monthly-summary" id="monthlySummary">
                            <p class="empty-text">Chưa có dữ liệu</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Admin (Quản lý - chỉ GVCN) -->
            <div class="tab-content" id="tab-admin">
                <div class="admin-layout">
                    <!-- Groups Management -->
                    <div class="admin-card">
                        <h3><i class="fas fa-layer-group"></i> Quản lý Tổ</h3>
                        <form id="groupForm" class="admin-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Tên Tổ</label>
                                    <input type="text" id="groupName" placeholder="VD: Tổ 1" required>
                                </div>
                                <button type="submit" class="btn btn-primary" id="groupSubmitBtn">
                                    <i class="fas fa-plus"></i> Thêm Tổ
                                </button>
                            </div>
                        </form>
                        <div class="admin-list" id="groupsList">
                            <p class="empty-text">Chưa có tổ nào</p>
                        </div>
                    </div>

                    <!-- Accounts Management -->
                    <div class="admin-card">
                        <h3><i class="fas fa-users-cog"></i> Quản lý Tài khoản Tổ trưởng</h3>
                        <form id="accountForm" class="admin-form">
                            <div class="form-group">
                                <label>Tên hiển thị</label>
                                <input type="text" id="accountName" placeholder="VD: Nguyễn Văn A" required>
                            </div>
                            <div class="form-group">
                                <label>Tên đăng nhập</label>
                                <input type="text" id="accountUsername" placeholder="VD: to1" required>
                            </div>
                            <div class="form-group">
                                <label>Mật khẩu</label>
                                <input type="password" id="accountPassword" placeholder="Nhập mật khẩu" required>
                            </div>
                            <div class="form-group">
                                <label>Tổ quản lý</label>
                                <select id="accountGroup" required>
                                    <option value="">-- Chọn Tổ --</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary" id="accountSubmitBtn">
                                    <i class="fas fa-plus"></i> Thêm tài khoản
                                </button>
                                <button type="button" class="btn btn-secondary" id="accountResetBtn">
                                    <i class="fas fa-redo"></i> Làm mới
                                </button>
                            </div>
                        </form>
                        <div class="admin-list" id="accountsList">
                            <p class="empty-text">Chưa có tài khoản nào</p>
                        </div>
                    </div>

                    <!-- Violation Categories Management -->
                    <div class="admin-card">
                        <h3><i class="fas fa-exclamation-triangle"></i> Danh mục Vi phạm</h3>
                        <form id="violationCatForm" class="admin-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Tên vi phạm</label>
                                    <input type="text" id="violationCatName" placeholder="VD: Đi học muộn" required>
                                </div>
                                <div class="form-group" style="width: 100px;">
                                    <label>Điểm trừ</label>
                                    <input type="number" id="violationCatPoints" placeholder="-5" max="0" required>
                                </div>
                                <button type="submit" class="btn btn-primary" id="violationCatSubmitBtn">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </form>
                        <div class="admin-list" id="violationCatList">
                            <p class="empty-text">Đang tải...</p>
                        </div>
                    </div>

                    <!-- Reward Categories Management -->
                    <div class="admin-card">
                        <h3><i class="fas fa-star"></i> Danh mục Khen thưởng</h3>
                        <form id="rewardCatForm" class="admin-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Tên khen thưởng</label>
                                    <input type="text" id="rewardCatName" placeholder="VD: Giúp đỡ lớp" required>
                                </div>
                                <div class="form-group" style="width: 100px;">
                                    <label>Điểm cộng</label>
                                    <input type="number" id="rewardCatPoints" placeholder="5" min="0" required>
                                </div>
                                <button type="submit" class="btn btn-primary" id="rewardCatSubmitBtn">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </form>
                        <div class="admin-list" id="rewardCatList">
                            <p class="empty-text">Đang tải...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <div class="modal-icon warning">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3>Xác nhận xóa</h3>
            <p id="deleteModalText">Bạn có chắc muốn xóa?</p>
            <div class="modal-btns">
                <button class="modal-btn cancel" id="cancelDelete">Hủy</button>
                <button class="modal-btn confirm" id="confirmDelete">Xóa</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Thao tác thành công!</span>
    </div>

    <script src="app.js"></script>
</body>
</html>
